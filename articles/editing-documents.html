<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modifying Rmd and Quarto Documents • parsermd</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="editing-documents_files/libs/quarto-html/popper.min.js"></script><script src="editing-documents_files/libs/quarto-html/tippy.umd.min.js"></script><link href="editing-documents_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="editing-documents_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modifying Rmd and Quarto Documents">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parsermd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/parsermd.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/editing-documents.html">Modifying Rmd and Quarto Documents</a></li>
    <li><a class="dropdown-item" href="../articles/templates.html">Rmd Templates</a></li>
    <li><a class="dropdown-item" href="../articles/know-your-nodes.html">Know Your Nodes</a></li>
    <li><a class="dropdown-item" href="../articles/assignment-with-key.html">Example - Assignment with Key</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rundel/parsermd/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Modifying Rmd and Quarto Documents</h1>




      <small class="dont-index">Source: <a href="https://github.com/rundel/parsermd/blob/main/vignettes/editing-documents.qmd" class="external-link"><code>vignettes/editing-documents.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rundel.github.io/parsermd/">parsermd</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>While parsing and selecting content from R Markdown and Quarto documents is powerful, the true potential of <code>parsermd</code> is realized when you start programmatically modifying those documents. This vignette covers the core functions for editing <code>rmd_ast</code> objects: <code>rmd_modify</code>, <code>rmd_insert</code>, and <code>rmd_fenced_div_wrap</code>.</p>
<p>These tools allow you to perform a wide range of tasks, such as:</p>
<ul>
<li>Updating chunk options across an entire document.</li>
<li>Inserting boilerplate content into specific sections.</li>
<li>Wrapping existing content with new structural elements, like callout blocks.</li>
<li>Refactoring and reorganizing documents automatically.</li>
</ul>
<p>Let’s start with a sample document that we’ll modify throughout this vignette. We start by parsing it into an <code>rmd_ast</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hw</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/hw01.Rmd"</span>, package <span class="op">=</span> <span class="st">"parsermd"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">rmd</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_rmd.html">parse_rmd</a></span><span class="op">(</span><span class="va">hw</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ├── YAML [2 fields]</span></span>
<span><span class="co">#&gt; ├── Heading [h3] - Load packages</span></span>
<span><span class="co">#&gt; │   └── Chunk [r, 2 lines] - load-packages</span></span>
<span><span class="co">#&gt; ├── Heading [h3] - Exercise 1</span></span>
<span><span class="co">#&gt; │   ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │   └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt; │       └── Markdown [1 line]</span></span>
<span><span class="co">#&gt; ├── Heading [h3] - Exercise 2</span></span>
<span><span class="co">#&gt; │   ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │   └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt; │       ├── Markdown [3 lines]</span></span>
<span><span class="co">#&gt; │       ├── Chunk [r, 5 lines] - plot-dino</span></span>
<span><span class="co">#&gt; │       ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │       └── Chunk [r, 2 lines] - cor-dino</span></span>
<span><span class="co">#&gt; └── Heading [h3] - Exercise 3</span></span>
<span><span class="co">#&gt;     ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt;     └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt;         ├── Markdown [3 lines]</span></span>
<span><span class="co">#&gt;         ├── Chunk [r, 1 line] - plot-star</span></span>
<span><span class="co">#&gt;         ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt;         └── Chunk [r, 1 line] - cor-star</span></span></code></pre></div>
</div>
<hr></section><section class="section level2"><h2 id="modifying-nodes-with-rmd_modify">Modifying Nodes with <code>rmd_modify()</code>
<a class="anchor" aria-label="anchor" href="#modifying-nodes-with-rmd_modify"></a>
</h2>
<p>The <code><a href="../reference/rmd_modify.html">rmd_modify()</a></code> function is your primary tool for changing the properties of existing nodes in the AST. It works by applying a function to all nodes that match a specific selector.</p>
<p>The syntax is <code>rmd_modify(x, .f, ...)</code>, where:</p>
<ul>
<li>
<code>x</code> is the <code>rmd_ast</code> object.</li>
<li>
<code>.f</code> is a function that takes a node as input and returns the modified node.</li>
<li>
<code>...</code> are selection arguments using tidyselect syntax, usually one or more of the <code><a href="../reference/rmd_select.html">rmd_select()</a></code> helper functions.</li>
</ul>
<section class="level2"><h3 id="example-changing-chunk-options">Example: Changing Chunk Options<a class="anchor" aria-label="anchor" href="#example-changing-chunk-options"></a>
</h3>
<p>Let’s say you want to standardize the figure dimensions for all plot chunks in your document. You can use <code><a href="../reference/rmd_modify.html">rmd_modify()</a></code> to update the <code>fig.width</code> and <code>fig.height</code> options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rmd_figs</span> <span class="op">=</span> <span class="va">rmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_modify.html">rmd_modify</a></span><span class="op">(</span></span>
<span>    <span class="co"># The function to apply to each selected node</span></span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/rmd_node_utilities.html">rmd_node_set_options</a></span><span class="op">(</span><span class="va">node</span>, fig.width <span class="op">=</span> <span class="fl">8</span>, fig.height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    <span class="co"># The selection criteria - chunks that already have figure options</span></span>
<span>    <span class="fu"><a href="../reference/rmd_select_helpers.html">has_type</a></span><span class="op">(</span><span class="st">"rmd_chunk"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's inspect the options of the original plot-dino chunk before modification</span></span>
<span><span class="fu"><a href="../reference/rmd_select.html">rmd_select</a></span><span class="op">(</span><span class="va">rmd</span>, <span class="fu"><a href="../reference/rmd_select_helpers.html">has_label</a></span><span class="op">(</span><span class="st">"plot-dino"</span><span class="op">)</span>, keep_yaml <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_node_utilities.html">rmd_node_options</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ fig-height: num 3</span></span>
<span><span class="co">#&gt;   ..$ fig-width : num 6</span></span>
<span></span>
<span><span class="co"># and after modification</span></span>
<span><span class="fu"><a href="../reference/rmd_select.html">rmd_select</a></span><span class="op">(</span><span class="va">rmd_figs</span>, <span class="fu"><a href="../reference/rmd_select_helpers.html">has_label</a></span><span class="op">(</span><span class="st">"plot-dino"</span><span class="op">)</span>, keep_yaml <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_node_utilities.html">rmd_node_options</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ fig-height: num 5</span></span>
<span><span class="co">#&gt;   ..$ fig-width : num 8</span></span></code></pre></div>
</div>
<p>Notice how the figure dimensions changed from <code>fig.width = 6, fig.height = 3</code> to the new standardized <code>fig.width = 8, fig.height = 5</code>.</p>
</section><section class="level2"><h3 id="example-modifying-text-content">Example: Modifying Text Content<a class="anchor" aria-label="anchor" href="#example-modifying-text-content"></a>
</h3>
<p>Beyond changing metadata like chunk options, <code><a href="../reference/rmd_modify.html">rmd_modify()</a></code> can also be used to alter the content of nodes. For example, you could perform a search-and-replace operation on all markdown text in a specific section.</p>
<p>Let’s replace the word “correlation” with “covariance” in the “Exercise 2” section of our document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a function to replace text in markdown nodes</span></span>
<span><span class="va">replace_content</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/rmd_node_utilities.html">rmd_node_set_content</a></span><span class="op">(</span></span>
<span>    <span class="va">node</span>,</span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/rmd_node_utilities.html">rmd_node_content</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span>,</span>
<span>      <span class="st">"correlation"</span>,</span>
<span>      <span class="st">"covariance"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Apply this function to the "Exercise 2" section markdown nodes</span></span>
<span><span class="va">rmd_text</span> <span class="op">=</span> <span class="va">rmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_modify.html">rmd_modify</a></span><span class="op">(</span></span>
<span>    .f <span class="op">=</span> <span class="va">replace_content</span>,</span>
<span>    <span class="fu"><a href="../reference/rmd_select_helpers.html">by_section</a></span><span class="op">(</span><span class="st">"Exercise 2"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="../reference/rmd_select_helpers.html">has_type</a></span><span class="op">(</span><span class="st">"rmd_markdown"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's see the modified text</span></span>
<span><span class="va">rmd_text</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_select.html">rmd_select</a></span><span class="op">(</span><span class="fu"><a href="../reference/rmd_select_helpers.html">by_section</a></span><span class="op">(</span><span class="st">"Exercise 2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_document.html">as_document</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; title: Homework 01 - Hello R</span></span>
<span><span class="co">#&gt; output: html_document</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; ### Exercise 2</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Plot `y` vs. `x` for the `dino` dataset. Then, calculate the covariance coefficient between x and y for this dataset.</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; #### Solution</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; (The answers for this Exercise are given for you below. But you should clean up some of the narrative so that it only includes what you want to turn in.)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; First let's plot the data in the dino dataset:</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; ```{r plot-dino}</span></span>
<span><span class="co">#&gt; #| fig-height: 3.0</span></span>
<span><span class="co">#&gt; #| fig-width: 6.0</span></span>
<span><span class="co">#&gt; dino_data &lt;- datasaurus_dozen %&gt;%</span></span>
<span><span class="co">#&gt;   filter(dataset == "dino")</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; ggplot(data = dino_data, mapping = aes(x = x, y = y)) +</span></span>
<span><span class="co">#&gt;   geom_point()</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; And next calculate the covariance between `x` and `y` in this dataset:</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; ```{r cor-dino}</span></span>
<span><span class="co">#&gt; dino_data %&gt;%</span></span>
<span><span class="co">#&gt;   summarize(r = cor(x, y))</span></span>
<span><span class="co">#&gt; ```</span></span></code></pre>
</div>
<p>This example shows how you can define a function that operates on markdown content to programmatically change the document’s text.</p>
<hr></section></section><section class="section level2"><h2 id="inserting-nodes-with-rmd_insert">Inserting Nodes with <code>rmd_insert()</code>
<a class="anchor" aria-label="anchor" href="#inserting-nodes-with-rmd_insert"></a>
</h2>
<p>To add new content to a document, you can use <code><a href="../reference/rmd_insert.html">rmd_insert()</a></code>. This function allows you to insert one or more <code>rmd_node</code> objects before or after a selected location.</p>
<p>The syntax is <code>rmd_insert(x, ..., nodes, location = c("before", "after"), allow_multiple = FALSE)</code>, where:</p>
<ul>
<li>
<code>x</code> is the <code>rmd_ast</code> object.</li>
<li>
<code>...</code> are selection arguments for specifying the insertion point.</li>
<li>
<code>nodes</code> are the <code>rmd_node</code> objects to insert.</li>
<li>
<code>location</code> specifies whether to insert “before” or “after” the selected nodes.</li>
</ul>
<section class="level2"><h3 id="example-adding-a-setup-chunk">Example: Adding a Setup Chunk<a class="anchor" aria-label="anchor" href="#example-adding-a-setup-chunk"></a>
</h3>
<p>A common task is to add a setup chunk at the beginning of a document (right after the YAML front matter). Let’s create a setup chunk and insert it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a new setup chunk</span></span>
<span><span class="va">setup</span> <span class="op">=</span> <span class="fu"><a href="../reference/rmd_chunk.html">rmd_chunk</a></span><span class="op">(</span></span>
<span>  engine <span class="op">=</span> <span class="st">"r"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"setup"</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>include <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"knitr::opts_chunk$set(echo = TRUE)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">setup</span></span>
<span><span class="co">#&gt; &lt;rmd_chunk&gt;</span></span>
<span><span class="co">#&gt;  @ engine : chr "r"</span></span>
<span><span class="co">#&gt;  @ label  : chr "setup"</span></span>
<span><span class="co">#&gt;  @ options:List of 1</span></span>
<span><span class="co">#&gt;  .. $ include: logi FALSE</span></span>
<span><span class="co">#&gt;  @ code   : chr "knitr::opts_chunk$set(echo = TRUE)"</span></span>
<span><span class="co">#&gt;  @ indent : chr ""</span></span>
<span><span class="co">#&gt;  @ n_ticks: int 3</span></span></code></pre></div>
</div>
<p>Now, let’s insert it after the YAML header.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Insert the new chunk after the YAML node</span></span>
<span><span class="va">rmd_setup</span> <span class="op">=</span> <span class="va">rmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_insert.html">rmd_insert</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/rmd_select_helpers.html">has_type</a></span><span class="op">(</span><span class="st">"rmd_yaml"</span><span class="op">)</span>,</span>
<span>    nodes <span class="op">=</span> <span class="va">setup</span>,</span>
<span>    location <span class="op">=</span> <span class="st">"after"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the top of the document to see the new chunk</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rmd_setup</span><span class="op">)</span></span>
<span><span class="co">#&gt; ├── YAML [2 fields]</span></span>
<span><span class="co">#&gt; ├── Chunk [r, 1 line] - setup</span></span>
<span><span class="co">#&gt; ├── Heading [h3] - Load packages</span></span>
<span><span class="co">#&gt; │   └── Chunk [r, 2 lines] - load-packages</span></span>
<span><span class="co">#&gt; ├── Heading [h3] - Exercise 1</span></span>
<span><span class="co">#&gt; │   ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │   └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt; │       └── Markdown [1 line]</span></span>
<span><span class="co">#&gt; ├── Heading [h3] - Exercise 2</span></span>
<span><span class="co">#&gt; │   ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │   └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt; │       ├── Markdown [3 lines]</span></span>
<span><span class="co">#&gt; │       ├── Chunk [r, 5 lines] - plot-dino</span></span>
<span><span class="co">#&gt; │       ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │       └── Chunk [r, 2 lines] - cor-dino</span></span>
<span><span class="co">#&gt; └── Heading [h3] - Exercise 3</span></span>
<span><span class="co">#&gt;     ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt;     └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt;         ├── Markdown [3 lines]</span></span>
<span><span class="co">#&gt;         ├── Chunk [r, 1 line] - plot-star</span></span>
<span><span class="co">#&gt;         ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt;         └── Chunk [r, 1 line] - cor-star</span></span></code></pre></div>
</div>
<p>The <code>setup</code> chunk has been successfully added to the AST.</p>
<hr></section></section><section class="section level2"><h2 id="working-with-structural-elements">Working with Structural Elements<a class="anchor" aria-label="anchor" href="#working-with-structural-elements"></a>
</h2>
<p>Tools like Quarto have introduced powerful structural elements like Fenced Divs (<code>:::</code>) and Shortcodes (<code>{{&lt; ... &gt;}}</code>) for creating complex layouts and embedding content. <code>parsermd</code> provides functions to both create and interact with these elements.</p>
<section class="level2"><h3 id="wrapping-nodes-in-fenced-divs">Wrapping Nodes in Fenced Divs<a class="anchor" aria-label="anchor" href="#wrapping-nodes-in-fenced-divs"></a>
</h3>
<p>The <code><a href="../reference/rmd_fenced_div_wrap.html">rmd_fenced_div_wrap()</a></code> function makes it easy to wrap existing nodes in a new fenced div, which is useful for creating things like callout blocks or columns.</p>
<p>Let’s wrap the “Exercise 1” section of our document in a “warning” callout block to make it more prominent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Wrap the selected section in a warning callout</span></span>
<span><span class="va">rmd_wrap</span> <span class="op">=</span> <span class="va">rmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_fenced_div_wrap.html">rmd_fenced_div_wrap</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/rmd_select_helpers.html">by_section</a></span><span class="op">(</span><span class="st">"Exercise 1"</span><span class="op">)</span>,</span>
<span>    open <span class="op">=</span> <span class="fu"><a href="../reference/rmd_fenced_div_open.html">rmd_fenced_div_open</a></span><span class="op">(</span>classes <span class="op">=</span> <span class="st">".callout-warning"</span>, id <span class="op">=</span> <span class="st">"#note-callout"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's view the new structure as a document</span></span>
<span><span class="va">rmd_wrap</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rmd_select.html">rmd_select</a></span><span class="op">(</span><span class="fu"><a href="../reference/rmd_select_helpers.html">by_section</a></span><span class="op">(</span><span class="st">"Exercise 1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ├── YAML [2 fields]</span></span>
<span><span class="co">#&gt; ├── Fenced div (open) [#note-callout, .callout-warning]</span></span>
<span><span class="co">#&gt; │   └── Heading [h3] - Exercise 1</span></span>
<span><span class="co">#&gt; │       ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │       └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt; │           └── Markdown [1 line]</span></span>
<span><span class="co">#&gt; └── Fenced div (close)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="selecting-content-inside-fenced-divs">Selecting Content Inside Fenced Divs<a class="anchor" aria-label="anchor" href="#selecting-content-inside-fenced-divs"></a>
</h3>
<p>Once you have fenced divs in your document, you might want to select the content <em>inside</em> them. You can do this with the <code>by_fdiv()</code> selection helper.</p>
<p>Let’s use the document we just created and select the content inside the callout.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rmd_select.html">rmd_select</a></span><span class="op">(</span></span>
<span>  <span class="va">rmd_wrap</span>,</span>
<span>  <span class="fu"><a href="../reference/rmd_select_helpers.html">by_fenced_div</a></span><span class="op">(</span>class<span class="op">=</span><span class="st">".callout-warning"</span><span class="op">)</span>,</span>
<span>  keep_yaml <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ├── Fenced div (open) [#note-callout, .callout-warning]</span></span>
<span><span class="co">#&gt; │   └── Heading [h3] - Exercise 1</span></span>
<span><span class="co">#&gt; │       ├── Markdown [1 line]</span></span>
<span><span class="co">#&gt; │       └── Heading [h4] - Solution</span></span>
<span><span class="co">#&gt; │           └── Markdown [1 line]</span></span>
<span><span class="co">#&gt; └── Fenced div (close)</span></span></code></pre></div>
</div>
<p>The <code><a href="../reference/rmd_select_helpers.html">by_fenced_div()</a></code> helper is very powerful. It takes another selection expression as its argument, allowing you to find divs based on their ID, classes, or attributes, and then selects all the nodes contained within that div.</p>
</section><section class="level2"><h3 id="working-with-shortcodes">Working with Shortcodes<a class="anchor" aria-label="anchor" href="#working-with-shortcodes"></a>
</h3>
<p>Shortcodes (<code>{{&lt; ... &gt;}}</code>) are another powerful way to embed complex or dynamic content in Quarto documents. <code>parsermd</code> allows you to find and even modify these shortcodes.</p>
<section class="level3"><h4 id="extracting-shortcodes">Extracting Shortcodes<a class="anchor" aria-label="anchor" href="#extracting-shortcodes"></a>
</h4>
<p>Let’s imagine we have a document that uses shortcodes to embed videos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"---"</span>,</span>
<span>  <span class="st">"title: My Video Collection"</span>,</span>
<span>  <span class="st">"---"</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"# Introduction"</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"Here is my first video:"</span>,</span>
<span>  <span class="st">"{{&lt; video https://example.com/video1.mp4 &gt;}}"</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"And here is another one with more options:"</span>,</span>
<span>  <span class="st">"{{&lt; video https://example.com/video2.mp4 title=\"Second Video\" &gt;}}"</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"{{&lt; pagebreak &gt;}}"</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"That's all for now!"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parse the text</span></span>
<span><span class="va">qmd</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_rmd.html">parse_qmd</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Shortcodes are part of <code>rmd_markdown</code> nodes. To find them, we can use the <code><a href="../reference/shortcode_utils.html">rmd_extract_shortcodes()</a></code> function on the content of a markdown node.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the markdown node containing the first shortcode</span></span>
<span><span class="va">md</span> <span class="op">=</span> <span class="fu"><a href="../reference/rmd_select.html">rmd_select</a></span><span class="op">(</span><span class="va">qmd</span>, <span class="fu"><a href="../reference/rmd_select_helpers.html">has_type</a></span><span class="op">(</span><span class="st">"rmd_markdown"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="../reference/rmd_select_helpers.html">has_shortcode</a></span><span class="op">(</span><span class="op">)</span>, keep_yaml <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Extract shortcodes from that node</span></span>
<span><span class="op">(</span><span class="va">shortcodes</span> <span class="op">=</span> <span class="fu"><a href="../reference/shortcode_utils.html">rmd_extract_shortcodes</a></span><span class="op">(</span><span class="va">md</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;  rmd_shortcode[0,44] {{&lt; video https://example.com/video1.mp4 &gt;}}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;  rmd_shortcode[0,65] {{&lt; video https://example.com/video2.mp4 title="Second Video" &gt;}}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;  rmd_shortcode[0,17] {{&lt; pagebreak &gt;}}</span></span></code></pre></div>
</div>
<p>The function returns a list of <code>rmd_shortcode</code> objects, giving you access to the function name and arguments.</p>
</section><section class="level3"><h4 id="modifying-shortcodes">Modifying Shortcodes<a class="anchor" aria-label="anchor" href="#modifying-shortcodes"></a>
</h4>
<p>Since shortcodes are part of the markdown text, modifying them involves changing the <code>lines</code> property of the containing <code>rmd_markdown</code> node.</p>
<p>Let’s say we want to replace all <code>video</code> shortcodes with a placeholder message but leave the pagebreak intact.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">replace_videos</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">node</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if the node contains a video shortcode</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/shortcode_utils.html">rmd_has_shortcode</a></span><span class="op">(</span><span class="va">node</span>, <span class="st">"video"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/rmd_node_utilities.html">rmd_node_set_content</a></span><span class="op">(</span></span>
<span>      <span class="va">node</span>,</span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/rmd_node_utilities.html">rmd_node_content</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span>,</span>
<span>        <span class="st">"\\{\\{&lt; video .* &gt;\\}\\}"</span>,</span>
<span>        <span class="st">"[VIDEO PLACEHOLDER]"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># If not a video shortcode, return the node unchanged</span></span>
<span>    <span class="va">node</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Apply the modification to the whole document</span></span>
<span><span class="va">qmd_modified</span> <span class="op">=</span> <span class="fu"><a href="../reference/rmd_modify.html">rmd_modify</a></span><span class="op">(</span><span class="va">qmd</span>, <span class="va">replace_videos</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See the result</span></span>
<span><span class="fu"><a href="../reference/as_document.html">as_document</a></span><span class="op">(</span><span class="va">qmd_modified</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; title: My Video Collection</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Introduction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Here is my first video:</span></span>
<span><span class="co">#&gt; [VIDEO PLACEHOLDER]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; And here is another one with more options:</span></span>
<span><span class="co">#&gt; [VIDEO PLACEHOLDER]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; {{&lt; pagebreak &gt;}}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; That's all for now!</span></span></code></pre></div>
</div>
<p>This demonstrates how you can use <code>rmd_modify</code> in combination with text manipulation functions to alter shortcodes.</p>
</section></section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Colin Rundel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
